\section{Анализ задания}
В рамках курса было необходимо разработать приложение для распределенных вычислительных систем. Приложение должно удовлетворять требованиям открытости, масштабируемости и прозрачности, применять технологии EJB и JPA и использовать Web-интерфейс для взаимодействия с пользователем.

Было решено разработать информационную систему для научного журнала.

\subsection{Роли}

В проекте выделено 3 роли: исследователь, редакция и рецензент:

\begin{itemize}
\item Исследователь

\begin{itemize}
\item Разрабатывает научную тему
\item Пишет статью по ней
\item Принимает замечания по ней
\item \textit{Цель:} Чтобы его статья была опубликована в журнале
\end{itemize}
\item Рецензент

\begin{itemize}
\item Выбирается редакцией
\item Получает статьи для просмотра
\item Дает оценку статье (стоит ли принимать для публикации)
\item Высказывает замечания, возникшие при прочтении статьи
\item \textit{Цель:} Выбрать подходящие статьи
\end{itemize}
\item Редакция

\begin{itemize}
\item Принимает статьи
\item Устанавливает правила принятия статей
\item Подбирает рецензентов
\item Связывает рецензентов и авторов
\item Корректирует статьи, если необходимо
\item Издает журнал с помощью типографии
\item \textit{Цель:} Принять качественные статьи, заработать на продаже журналов
\end{itemize}
\end{itemize}

\section{Варианты использования}

\subsection{Написание и подача статьи}

\begin{enumerate}
\item
  \textbf{Исследователь} самостоятельно выбирает интересную ему тему и проводит по ней исследования. \\
  По результататам исследований автор пишет
  \textbf{научную статью}. Для написания статьи автор использует текстовый редактор без форматирования (например, Notepad). Исследователь на этом этапе имеет статью в виде plain text, сформулированный для неё \textbf{реферат} (\textbf{abstract}) и \textbf{заголовок}.
\item
  Автор заходит на \textbf{веб-сайт журнала} для публикации. На сайте имеются разделы для разных ролей, и автор выбирает раздел для исследователей (щелкает на ссылку "Публикации").
\item Для дальнейшей работы автору необходимо аутентифицироваться. Автор видит на странице список исследователей. Из них автор выбирает себя (пользователя со своим \textbf{именем}) и нажимает кнопку "Войти".
\item
  Автор заполняет на странице поля <<Заголовок>>, <<Реферат (Abstract)>> и <<Содержимое статьи (Content)>>. После заполнения всех полей автор нажимает кнопку <<Подать>>.
\item
  Автор видит свою статью (с тем же названием и рефератом, которые он только что ввел) в списке статей
  
  \begin{itemize}
  \item
    Альтернатива: Редакция журнала сама готова привести
    \textbf{форматирование} к требуемому виду
  \end{itemize}
\end{enumerate}

\subsection{Проверка статьи редактором журнала}

\begin{enumerate}
\item
  \textbf{Редактор} заходит на веб-сайт журнала и выбирает на нем раздел для редакторов (щелкает по ссылке <<Редакция>>)
\item
  Редактор видит список, в котором перечислены новые (ещё не просмотренные) статьи. В списке для каждой статьи указан её заголовок, реферат и непосредственно содержимое.
\item Редактор решает, что статья соответствует тематике журнала и удовлетворяет правилам оформления. Редактор нажимает кнопку <<Одобрить>>. Странице обновляется, и статья пропадает из списка не просмотренных статей.
  \begin{itemize}
  \item
    Альтернатива: Редакция отказывает в приеме статьи по причине недоработок в статье (например, проблемах с форматированием). Редактор в текстовом поле указывает \textbf{список замечаний}, который будет передан автору, и нажимает кнопку <<Отправить на доработку>>
  \item
    Альтернатива: Редакция отказывает в приеме по причине несоответствия тематике журнала. Редактор в текстовом поле указывает \textbf{список замечаний}, который будет передан автору, и нажимает кнопку <<Статья для другого журнала>>.
  \end{itemize}
\end{enumerate}

\subsection{Рецензирование}

\begin{enumerate}
\item \textbf{Рецензент} заходит на \textbf{веб-сайт журнала} и выбирает раздел для рецензентов (щелкает на ссылку "Рецензирование").
\item Для дальнейшей работы рецензенту необходимо аутентифицироваться. Автор видит на странице список рецензентов. Из них рецензент выбирает себя (пользователя со своим \textbf{именем}) и нажимает кнопку "Войти".
\item Рецензент видит список, в котором перечислены новые (ещё не просмотренные) статьи. В списке для каждой статьи указан её заголовок, реферат и непосредственно содержимое.
\item
  Рецензент читает каждую статью и составляет \textbf{отчет} по ней,
  содержащий \textbf{замечания} и \textbf{общую оценку статьи}
\item
  Редактор одобряет статью для публикации (Accept). В поле <<Замечания>> на странице сайта он указывает свою рецензию. Рецензент нажимает кнопку <<Accept>>, статья отмечается в системе как принятая и исчезает из списка не просмотренных.
  
  \begin{itemize}
  \item
    Альтернатива: Редактор имеет замечания к статье, но допускает её для публикации (Neutral). В поле <<Замечания>> на странице сайта он указывает свою рецензию. Рецензент нажимает кнопку <<Neutral>>, статья отмечается в системе как принятая и исчезает из списка не просмотренных.
  \item
    Альтернатива: Редактор имеет замечания к статье и не допускает её для публикации (Reject). В поле <<Замечания>> на странице сайта он указывает свою рецензию. Рецензент нажимает кнопку <<Reject>>, статья отмечается в системе как не принятая и исчезает из списка не просмотренных.
  \end{itemize}
\end{enumerate}

\subsection{Диаграмма вариантов использования}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{../UseCases.png}
\caption{Диаграмма вариантов использования}
\end{figure}

\subsection{Модель предметной области}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{../ClassDiagram.png}
\caption{Модель предметной области}
\end{figure}

\subsection{Диаграмма последовательностей}

\subsubsection{Написание статьи и отправка в
журнал}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{../Seq1.png}
\caption{}
\end{figure}

\subsubsection{Рецензирование}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{../Seq2.png}
\caption{}
\end{figure}

\section{Реализация задания с помощью технологии EJB}

\subsection{Объектно-ориентированное проектирование с учётом особенностей технологии}

Ниже приведена диаграмма классов для пакета objects, в котором содержатся классы, соответствующие сущностям предметной области. Альтернативы из вариантов использования представлены в приложении в виде перечислений Decision и Mark.

Для отслеживания состояния статьи используется перечисление State, имеющее варианты для каждого этапа обработки статьи.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{diagram.pdf}
\caption{Диаграмма класса для пакета objects}
\end{figure}

Ниже приведена диаграмма классов для пакетов services и repository, содержащих различные сервисы, используемые в приложении.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{diagram2.pdf}
\caption{}
\end{figure}

На рисунке \ref{fig:mapper} показана диаграмма классов для слоя хранения.

\begin{figure}[H]
\centering
\includegraphics[height=0.97\textheight]{diagram3.pdf}
\caption{}
\label{fig:mapper}
\end{figure}

\subsection{Описание программы}

Было решено, что в приложении будет два bean-а:
\begin{enumerate}
\item Facade - класс для реализации паттерна проектирования <<Фасад>>. Соответствующий Bean было решено сделать @Stateful, чтобы исключить проблемы, связанные с одновременным использованием одного экземпляра класса несколькими клиентами.
\item Repository - класс-репозиторий, содержащий ссылки на объекты-Mapper-ы. Так как все клиенты используют общий набор Mapper-ов, класс Repository был помечен аннотацией @Singleton.
\end{enumerate}

Класс Facade содержит следующие методы:

\begin{itemize}
\item getRepo() - возвращает объект-репозиторий. Внутри класса Facade содержится поле repo, которое автоматически заполняется EJB-контейнером при создании нового экземпляра класса. Для этого поле repo было помечено аннотацией @EJB.
\item addPaper() - добавляет статью в базу данных, и создает для неё новый объект <<Подача>> (Submission).
\item editorDecision(String uuidString, Set<String> params, String remarkText) - для указанной статьи устанавливает решение редактора и добавляет примечание
\item reviewerDecision(String uuidString, Set<String> params, String user, String remarkText) - для указанной статьи устанавливает решение рецензента и добавляет примечание
\end{itemize}

Для реализации Web-интерфейса была использована библиотека Spark, которая в свою очередь основана на API Servlet. Логика веб-интерфейса реализована в классе WebUI. В этом классе имеется только один метод, init, в котором устанавливаются обработчики для различных адресов. Для настройки сервера приложений использовался файл web.xml.

ORM реализован с помощью фреймворка Hibernate. Имеется класс Mapper, который осуществляет взаимодействие с EntityManager-ом. Пример получения данных из БД:

\begin{lstlisting}
CriteriaQuery<T> query = em.getCriteriaBuilder().createQuery(getEntityClass());
Root<T> root = query.from(getEntityClass());
query.select(root);
return em.createQuery(query).getResultList();
\end{lstlisting}

\subsection{Инструкция системного администратора}

Для корректной работы проекта требуется установить следующее ПО:

\begin{itemize}
\item Пакет Java Runtime Environment 8
\item Сервер приложений WildFly 10
\end{itemize}

Для сборки проекта необходимо выполнить команду ./gradlew war:

\begin{lstlisting}
$ ./gradlew war
:clean
:compileJava
:processResources
:classes
:war

BUILD SUCCESSFUL

Total time: 0.946 secs
\end{lstlisting}

Собранный war-файл доступен по следующему пути: build/libs/\\SoftwareArchitecture.war

После сборки необходимо установить и настроить WildFly. С помощью скрипта add-user.sh добавим пользователя-администратора:

\begin{lstlisting}
artyom@artyom-MSI:~/Tools/wildfly-10.1.0.Final$ bin/add-user.sh 

What type of user do you wish to add? 
 a) Management User (mgmt-users.properties) 
 b) Application User (application-users.properties)
(a): 

Enter the details of the new user to add.
Using realm 'ManagementRealm' as discovered from the existing property files.
Username : user
Password recommendations are listed below. To modify these restrictions edit the add-user.properties configuration file.
 - The password should be different from the username
 - The password should not be one of the following restricted values {root, admin, administrator}
 - The password should contain at least 8 characters, 1 alphabetic character(s), 1 digit(s), 1 non-alphanumeric symbol(s)
Password : 
WFLYDM0099: Password should have at least 8 characters!
Are you sure you want to use the password entered yes/no? yes
Re-enter Password : 
What groups do you want this user to belong to? (Please enter a comma separated list, or leave blank for none)[  ]: 
About to add user 'user' for realm 'ManagementRealm'
Is this correct yes/no? yes
Added user 'user' to file '/home/artyom/Tools/wildfly-10.1.0.Final/standalone/configuration/mgmt-users.properties'
Added user 'user' to file '/home/artyom/Tools/wildfly-10.1.0.Final/domain/configuration/mgmt-users.properties'
Added user 'user' with groups  to file '/home/artyom/Tools/wildfly-10.1.0.Final/standalone/configuration/mgmt-groups.properties'
Added user 'user' with groups  to file '/home/artyom/Tools/wildfly-10.1.0.Final/domain/configuration/mgmt-groups.properties'
Is this new user going to be used for one AS process to connect to another AS process? 
e.g. for a slave host controller connecting to the master or for a Remoting connection for server to server EJB calls.
yes/no? no
\end{lstlisting}

После добавления пользователя можно запустить сам сервер приложений с помощью скрипта standalone.sh

\begin{lstlisting}
artyom@artyom-MSI:~/Tools/wildfly-10.1.0.Final$ bin/standalone.sh
=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /home/artyom/Tools/wildfly-10.1.0.Final

  JAVA: /usr/lib/jvm/java-8-oracle/bin/java

  JAVA_OPTS:  -server -Xms64m -Xmx512m -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true

=========================================================================
...
13:13:05,239 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
13:13:05,239 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990
\end{lstlisting}

WildFly выведет на консоль адрес страницы для управления сервером приложения. Зайдем на неё с помощью браузера:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{wildfly.png}
\caption{}
\end{figure}

В пункте Deployment выберем пункт Start:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{wildfly2.png}
\caption{}
\end{figure}

Далее необходимо нажать на кнопку Add. Откроется окно, где нужно выбрать собранный war-файл:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{wildfly3.png}
\caption{}
\end{figure}

Развернутое приложение доступно по следующему адресу: \\ \url{http://127.0.0.1:8080/SoftwareArchitecture/}

\section{Тестирование}
\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{researcher.png}
\caption{Страница исследователя}
\end{figure}
Тестирование страницы исследователя:
\begin{center}
	\begin{longtable}{|p{0.3\linewidth}|p{0.3\linewidth}|p{0.3\linewidth}|}
		\hline
		\textbf{Вариант использования} & \textbf{Ожидаемый результат}&
		\textbf{Фактический результат}\\
		\hline
		Выбор исследователя из списка и нажатие кнопки отправить & Выбранный пользователь становится текущим & Над полем выбора пользователя появляется строчка: <<Current researcher is: Имя исследователя>> \\
		\hline
		Заполнение полей Title, Abstract и Content и нажатие кнопки <<Отправить>> & В списке статей появится новая статья & В разделе Submissions появляется новая запись \\
		\hline
	\end{longtable}
\end{center}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{editor.png}
\caption{Страница редактора}
\end{figure}
Тестирование страницы редактора:
\begin{center}
	\begin{longtable}{|p{0.3\linewidth}|p{0.3\linewidth}|p{0.3\linewidth}|}
		\hline
		\textbf{Вариант использования} & \textbf{Ожидаемый результат}&
		\textbf{Фактический результат}\\
		\hline
		Выбор статьи из списка и нажатие кнопки Accept & Статья перейдет в состояние <<Принято>> & Статья исчезает из списка на странице (помечается как просмотренная), на странице исследователя появляется отметка <<Review remark: ACCEPT Note: Сообщение>> \\
		\hline
		Выбор статьи из списка и нажатие кнопки Needs Rework & Статья перейдет в состояние <<Требуется исправление>> & Статья исчезает из списка на странице (помечается как просмотренная), на странице исследователя появляется отметка <<Review remark: NEEDS\_REWORK Note: Сообщение>> \\
		\hline
		Выбор статьи из списка и нажатие кнопки Redirect to another journal & Статья перейдет в состояние <<Статья для другого журнала>> & Статья исчезает из списка на странице (помечается как просмотренная), на странице исследователя появляется отметка <<Review remark: REDIRECT Note: Сообщение>> \\
		\hline
	\end{longtable}
\end{center}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{reviewer.png}
\caption{Страница рецензента}
\end{figure}
Тестирование страницы рецензента:
\begin{center}
	\begin{longtable}{|p{0.3\linewidth}|p{0.3\linewidth}|p{0.3\linewidth}|}
		\hline
		\textbf{Вариант использования} & \textbf{Ожидаемый результат}&
		\textbf{Фактический результат}\\
		\hline
		Выбор статьи из списка и нажатие кнопки Accept & Статья перейдет в состояние <<Готова для печати (In pool)>> для последующей отправки в журнал & Статья исчезает из списка на странице (помечается как просмотренная), на странице исследователя появляется отметка <<Review remark: ACCEPT Note: Сообщение>>, статья доступна для выгрузки в журнал \\
		\hline
		Выбор статьи из списка и нажатие кнопки Neutral & Статья перейдет в состояние <<Готова для печати (In pool)>> для последующей отправки в журнал & Статья исчезает из списка на странице (помечается как просмотренная), на странице исследователя появляется отметка <<Review remark: NEUTRAL Note: Сообщение>>, статья доступна для выгрузки в журнал \\
		\hline
		Выбор статьи из списка и нажатие кнопки Reject & Статья перейдет в состояние <<Отклонена (Rejected)>> & Статья исчезает из списка на странице (помечается как просмотренная), на странице исследователя появляется отметка <<Review remark: REJECTED Note: Сообщение>> \\
		\hline
	\end{longtable}
\end{center}

\section{Выводы}
В рамках данного курса были изучены принципы разработки программного обеспечения для распределенных вычислительных систем. Были изучены технологии EJB (Enterprise Java Beans) и JPA (Java Persistence API). В соответствии с этими принципами и с использованием перечисленных технологий было разработано приложение - информационная система для научного журнала.

В качестве сервера приложений использовался WildFly 10, в качестве ORM - Hibernate 5. Для хранения данных использовалась СУБД PostgreSQL 9.5.

Возможные пути улучшения разработанного приложения:

\begin{itemize}
\item Добавление возможности составления и верстки журнала. При этом возможно появление ещё одной роли - верстальщика. Результат верстки - электронный документ в одном из распространенных форматов (например, PDF).
\item Добавление интерфейса читателя
\end{itemize}

Приложение удовлетворяет требованиям прозрачности, масштабируемости и открытости, во многом благодаря использованию технологий HTML, EJB и JPA.